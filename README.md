# AuthTrack : SSH Log Analyzer and Visualization Tool

This project is a Python-based utility designed to analyze SSH authentication log files (e.g., `auth.log`), extract crucial information, enrich the data with geographical details, store it in a MySQL database, and generate insightful visualizations. It focuses on identifying brute-force attempts and monitoring successful user access.

## Features

* **Log Parsing:** Uses **Regular Expressions** to accurately extract date, time, user, IP address, connection status (`Accepted`, `Failed`, `Invalid`), and service from raw SSH log lines.
* **Geographical Enrichment:** Integrates with the **ipinfo.io API** to look up the **country** of origin for each recorded IP address.
* **Database Management:** Stores all processed log data in a structured **MySQL** database.
* **Data Visualization:** Generates two key graphical reports using `matplotlib`:
    * A bar chart showing the **Top Countries** originating **Failed or Invalid** login attempts (potential brute-force sources).
    * A bar chart detailing **Accepted Connections** per **User** per **Day**.
* **Custom Logging:** Writes a clean, structured log file (`auth.log`) for all data points that required country lookup (i.e., those that were recently added to the database or processed).

## Example Output

Below are sample visualizations generated by the tool:

![Failed Attempts by Country](/docs/failed_attempts.png)

*(The charts are generated automatically from the MySQL data.)*

## How It Works

1. Parse the raw SSH log using regex.  
2. Extract user, IP, status, and date.  
3. Enrich IPs with country data using ipinfo.io.  
4. Store results in the MySQL database.  
5. Visualize statistics with Matplotlib.  
6. Write a structured `auth.log` for newly processed entries.

## Project Structure

| File | Description |
| :--- | :--- |
| `main.py` | The main execution script. Orchestrates the flow: extraction, database connection, insertion (commented out by default), data retrieval, plotting, and custom logging. |
| `extraction.py` | Handles the **log file parsing** using regex patterns for `Accepted`, `Failed`, and `Invalid` login attempts and converts log dates into `datetime` objects. |
| `database_0.py` | Contains functions for **MySQL connectivity** and CRUD operations (Create Table, Insert, Update Country, Get Failed Attempts, Get Accepted Users, Get Logging Data). |
| `api_service.py` | Interfaces with the **ipinfo.io** service to fetch the country code associated with an IP address using an API key loaded from `.env`. |
| `dashboards.py` | Contains the logic for **data visualization** using `matplotlib`. Renders charts for failed attempts by country and accepted connections by user. |
| `country_names.py` | A dictionary mapping ISO **country codes** (e.g., `US`) to their **full names** (e.g., `United States`) for display in visualizations. |
| `file_logs.py` | Handles the creation of a **custom log file** (`auth.log`) using the Python `logging` module. |
| `.env` | Stores the **API\_KEY** for the ipinfo.io service. |
| `data/` | Directory containing the raw SSH log file to be processed (e.g., `small-auth.log`). |

---

## Database Schema

| Column       | Type        | Description |
|---------------|-------------|-------------|
| id            | INT (PK)    | Auto-increment primary key |
| date          | DATETIME    | Date and time of log entry |
| user          | VARCHAR(50) | Username used during login |
| ip            | VARCHAR(45) | Source IP address |
| status        | VARCHAR(20) | Accepted / Failed / Invalid |
| service       | VARCHAR(20) | Service name (e.g., sshd) |
| country       | VARCHAR(50) | Country name (via ipinfo) |

## Getting Started

### Prerequisites

1.  **Python 3.x**
2.  **MySQL Server** (running locally on `127.0.0.1:3306`)
3.  An API Key from **ipinfo.io** for geographical data enrichment.

### Setup

1.  **Clone the repository** and navigate to the project directory.
2.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt 
    ```
3.  **Configure Environment Variables:**
    Create a file named `.env` in the project root and add your API key:
    ```ini
    API_KEY="YOUR_IPINFO_API_KEY_HERE"
    ```
4.  **Database Configuration:**
    Ensure your MySQL server is running and you have a database named `PythonLogs`. The connection details in `database_0.py` are set to:
    * User: `root`
    * Password: `(empty)`
    * Host: `127.0.0.1`
    * Port: `3306`
5.  **Log File:**
    Place your raw SSH log file (e.g., `auth.log`) inside the `./data/` directory. The `main.py` script is currently configured to read `./data/small-auth.log`.

## ðŸ§  Usage Example

To run the analyzer:
```bash
python main.py
```
### Execution

The `main.py` script performs the analysis. By default, the database insertion and country data enrichment steps are commented out in `main.py`.

To run the full flow (including data insertion and country enrichment), uncomment the necessary lines in `main.py`:

## ðŸ“œ License

This project is licensed under the MIT License â€” do whatever the hell you want (but credit the author).

## ðŸ‘¤ Author

**Abdelaziz Ouedghiri**  
- ðŸ’¼ Founder of [Dynaut](https://dynaut.com) â€” Automation services & business tools  
- ðŸ“§ Contact: (add ur email or leave blank if u donâ€™t want spam)
